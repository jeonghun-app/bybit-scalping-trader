# 추세 필터 가이드 - 단타 전략 개선

## 🎯 핵심 아이디어

**"단타는 추세를 따라가야 한다"**

- 24시간 추세 ❌ → 30분~1시간 실시간 추세 ✅
- 개별 코인만 보기 ❌ → 비트코인 + 개별 코인 ✅
- 지표만 보기 ❌ → 지표 + 추세 + 거래량 ✅

---

## 📊 추세 분석 시스템

### 1. 비트코인 추세 (시장 전체 방향성)
```python
btc_trend = {
    'trend': 'UPTREND' | 'DOWNTREND' | 'SIDEWAYS',
    'strength': 0-100,  # 추세 강도
    'price_change_pct': 1.2,  # 1시간 변화율
    'ma_5': 87500,
    'ma_20': 87200
}
```

**분석 기간**: 최근 60분 (1시간)
**판단 기준**:
- MA5 > MA20 + 가격 상승 > 0.3% → 상승 추세
- MA5 < MA20 + 가격 하락 > 0.3% → 하락 추세
- 그 외 → 횡보

### 2. 개별 코인 추세
```python
coin_trend = {
    'trend': 'UPTREND' | 'DOWNTREND' | 'SIDEWAYS',
    'strength': 0-100,
    'price_change_pct': 2.5,  # 30분 변화율
    'volume_trend': 'INCREASING' | 'DECREASING',
    'ma_5': 0.35,
    'ma_20': 0.34
}
```

**분석 기간**: 최근 30분
**판단 기준**:
- MA5 > MA20 + 가격 상승 > 0.5% → 상승 추세
- MA5 < MA20 + 가격 하락 > 0.5% → 하락 추세
- 그 외 → 횡보

---

## 🎯 진입 필터 규칙

### 롱 진입 조건

#### ✅ 진입 가능
1. **강한 상승 추세**
   - 코인: 상승 추세 + 거래량 증가
   - 비트코인: 상승 또는 횡보
   - 예: 코인 +2.5%, BTC +1.2%

2. **약한 상승 추세**
   - 코인: 상승 추세 + 거래량 감소
   - 비트코인: 상승 또는 횡보
   - 예: 코인 +1.5%, BTC +0.5% (주의)

#### ❌ 진입 금지
1. **비트코인 강한 하락장**
   - BTC 하락 추세 + 강도 > 60
   - 예: BTC -1.5% (강한 하락)

2. **코인 하락 추세**
   - 코인 하락 추세
   - 예: 코인 -2.0%

3. **횡보장**
   - 코인 횡보
   - 예: 코인 -0.2% ~ +0.2%

### 숏 진입 조건

#### ✅ 진입 가능
1. **강한 하락 추세**
   - 코인: 하락 추세 + 거래량 증가
   - 비트코인: 하락 또는 횡보
   - 예: 코인 -2.5%, BTC -1.2%

2. **약한 하락 추세**
   - 코인: 하락 추세 + 거래량 감소
   - 비트코인: 하락 또는 횡보
   - 예: 코인 -1.5%, BTC -0.5% (주의)

#### ❌ 진입 금지
1. **비트코인 강한 상승장**
   - BTC 상승 추세 + 강도 > 60
   - 예: BTC +1.5% (강한 상승)

2. **코인 상승 추세**
   - 코인 상승 추세
   - 예: 코인 +2.0%

3. **횡보장**
   - 코인 횡보
   - 예: 코인 -0.2% ~ +0.2%

---

## 💡 실전 예시

### 예시 1: 롱 진입 성공
```
시간: 14:30
BTC: +1.2% (상승 추세)
ETHUSDT: +2.5% (상승 추세, 거래량 증가)
RSI: 32 (과매도)
볼린저: 하단 근처

→ ✅ 롱 진입!
이유: "강한 상승 추세 (코인 +2.5%, BTC +1.2%)"
```

### 예시 2: 롱 진입 거부
```
시간: 15:00
BTC: -1.5% (강한 하락 추세)
ETHUSDT: +1.0% (약한 상승)
RSI: 30 (과매도)
볼린저: 하단 근처

→ ❌ 진입 금지!
이유: "비트코인 강한 하락장 (BTC -1.5%)"
```

### 예시 3: 숏 진입 성공
```
시간: 16:00
BTC: -0.8% (약한 하락)
FOLKSUSDT: -3.0% (강한 하락, 거래량 증가)
RSI: 68 (과매수)
볼린저: 상단 근처

→ ✅ 숏 진입!
이유: "강한 하락 추세 (코인 -3.0%, BTC -0.8%)"
```

### 예시 4: 숏 진입 거부
```
시간: 17:00
BTC: +2.0% (강한 상승 추세)
FOLKSUSDT: -1.0% (약한 하락)
RSI: 70 (과매수)
볼린저: 상단 근처

→ ❌ 진입 금지!
이유: "비트코인 강한 상승장 (BTC +2.0%)"
```

---

## 🎯 기대 효과

### 1. 승률 개선
- **이전**: 추세 무시 → 역추세 진입 → 승률 30%
- **예상**: 추세 확인 → 순추세 진입 → 승률 50-60%

### 2. 손실 감소
- **이전**: 비트코인 폭락 중에도 롱 진입 → 큰 손실
- **예상**: 비트코인 폭락 시 진입 금지 → 손실 방지

### 3. 기회 포착
- **이전**: 롱만 → 하락장에서 기회 없음
- **예상**: 숏 추가 → 하락장에서도 수익

---

## 📋 백테스팅 체크리스트

### 확인 사항
- [ ] 비트코인 추세가 올바르게 계산되는가?
- [ ] 개별 코인 추세가 올바르게 계산되는가?
- [ ] 롱 진입 필터가 작동하는가?
- [ ] 숏 진입 필터가 작동하는가?
- [ ] 추세 정보가 출력되는가?

### 예상 결과
- **거래 횟수**: 감소 (필터링 효과)
- **승률**: 증가 (순추세 진입)
- **ROI**: 증가 (손실 감소 + 승률 증가)

---

## 🔧 조정 가능한 파라미터

### 비트코인 추세
```python
timeframe_minutes=60  # 30분 ~ 120분
uptrend_threshold=0.3  # 0.2% ~ 0.5%
downtrend_threshold=-0.3  # -0.2% ~ -0.5%
strong_trend_strength=60  # 50 ~ 80
```

### 개별 코인 추세
```python
timeframe_minutes=30  # 15분 ~ 60분
uptrend_threshold=0.5  # 0.3% ~ 1.0%
downtrend_threshold=-0.5  # -0.3% ~ -1.0%
```

---

## 🚀 다음 단계

1. ✅ **백테스팅 실행**
   ```bash
   python main_backtest.py
   ```

2. ⏳ **결과 분석**
   - 승률 변화 확인
   - ROI 변화 확인
   - 거래 횟수 변화 확인

3. ⏳ **파라미터 최적화**
   - 추세 기간 조정
   - 임계값 조정
   - 강도 기준 조정

4. ⏳ **실전 테스트**
   - 테스트넷 실시간 테스트
   - 소액 실전 테스트
