# 백테스팅 시간 분석 가이드

## 📊 측정 항목

### 코인별 측정
각 코인마다 다음 단계의 시간을 측정합니다:

1. **피보나치 계산** - 멀티 타임프레임 피보나치 레벨 계산
2. **캔들 데이터 로딩** - 해당 코인의 캔들 데이터 API 호출
3. **BTC 데이터 로딩** - 비트코인 캔들 데이터 API 호출
4. **지표 계산** - 볼린저 밴드, RSI 계산
5. **신호 탐색** - 슬라이딩 윈도우로 진입 신호 찾기
   - 평균 신호 분석 시간 (ms)
   - 총 신호 분석 시간

### 전체 통계
- 코인당 평균 시간
- 각 단계별 평균 시간 및 비율
- 총 백테스팅 시간
- 가장 느린 단계 식별

---

## 📈 출력 예시

```
================================================================================
심볼: BTCUSDT
================================================================================

[1/5] 멀티 타임프레임 피보나치 계산... ✅ 5개 타임프레임 (2.34초)
[2/5] 1분봉 데이터 로딩 (1000개)... ✅ 1000개 봉 (0.45초)
[3/5] 비트코인 추세 데이터 로딩... ✅ 1000개 봉 (0.42초)
[4/5] 지표 계산 (볼린저, RSI)... ✅ 완료 (0.15초)
[5/5] 진입 신호 탐색 (970개 봉)... ✅ 25개 신호, 25개 거래 완료 (12.50초)

⏱️  시간 분석:
   1. 피보나치 계산: 2.34초 (14.8%)
   2. 캔들 데이터 로딩: 0.45초 (2.8%)
   3. BTC 데이터 로딩: 0.42초 (2.7%)
   4. 지표 계산: 0.15초 (0.9%)
   5. 신호 탐색: 12.50초 (78.8%)
      - 평균 신호 분석: 12.9ms
      - 총 신호 분석: 12.50초
   📊 전체 시간: 15.86초
```

```
================================================================================
백테스팅 결과 요약
================================================================================

⏱️  전체 시간 분석
================================================================================

코인당 평균 시간: 15.50초
  1. 피보나치 계산: 2.30초 (14.8%)
  2. 캔들 데이터 로딩: 0.48초 (3.1%)
  3. BTC 데이터 로딩: 0.45초 (2.9%)
  4. 지표 계산: 0.18초 (1.2%)
  5. 신호 탐색: 12.09초 (78.0%)

총 백테스팅 시간: 155.00초 (2.6분)
코인 수: 10개

🐌 가장 느린 단계: 신호 탐색 (12.09초, 78.0%)

================================================================================
```

---

## 🎯 병목 지점 분석

### 일반적인 병목 순서

1. **신호 탐색 (70-80%)** - 가장 큰 병목
   - 매 캔들마다 전략 분석
   - 비트코인 추세 계산
   - 펀딩비 조회
   - 피보나치 거리 계산

2. **피보나치 계산 (10-20%)**
   - 5개 타임프레임 × API 호출
   - 네트워크 지연

3. **데이터 로딩 (5-10%)**
   - API 호출 시간
   - 네트워크 지연

4. **지표 계산 (1-2%)**
   - 계산 자체는 빠름

---

## 🚀 최적화 우선순위

### 1순위: 신호 탐색 최적화 (78% 병목)
```python
# 문제: 매 캔들마다 비트코인 추세 계산
for i in range(len(df)):
    btc_trend = get_btc_trend()  # 매번 API 호출!
    
# 해결: 사전 계산
btc_trends = precalculate_btc_trends()
for i in range(len(df)):
    btc_trend = btc_trends[i]  # 캐시에서 가져오기
```

**예상 효과**: 70-80% 시간 감소

### 2순위: 피보나치 계산 최적화 (15% 병목)
```python
# 문제: 5개 타임프레임 순차 호출
for tf in [5, 15, 30, 60, 240]:
    get_fibonacci(tf)  # 5번 API 호출
    
# 해결: 타임프레임 줄이기
for tf in [15, 60]:  # 2번만 호출
    get_fibonacci(tf)
```

**예상 효과**: 60% 시간 감소 (전체의 9%)

### 3순위: 데이터 로딩 최적화 (6% 병목)
```python
# 이미 최적화됨 (한 번만 로딩)
# 추가 최적화 어려움
```

---

## 📊 시나리오별 예상 시간

### 현재 (최적화 전)
- 1000 캔들 × 10 코인 = **2.6분**
- 코인당 평균: 15.5초

### 최적화 1단계 (신호 탐색 개선)
- 1000 캔들 × 10 코인 = **0.8분**
- 코인당 평균: 5초
- **70% 감소**

### 최적화 2단계 (피보나치 감소)
- 1000 캔들 × 10 코인 = **0.6분**
- 코인당 평균: 3.5초
- **77% 감소**

---

## 💡 실전 팁

### 1. 빠른 테스트
```python
BACKTEST_CANDLES = 200  # 1000 → 200
TOP_BACKTEST_COINS = 3  # 10 → 3
```
**예상 시간**: 2.6분 → 0.2분 (12초)

### 2. 중간 테스트
```python
BACKTEST_CANDLES = 500
TOP_BACKTEST_COINS = 5
```
**예상 시간**: 2.6분 → 1.0분

### 3. 완전 테스트
```python
BACKTEST_CANDLES = 1000
TOP_BACKTEST_COINS = 10
```
**예상 시간**: 2.6분

---

## 🔍 시간 분석 활용

### 1. 병목 지점 파악
```
🐌 가장 느린 단계: 신호 탐색 (12.09초, 78.0%)
```
→ 신호 탐색 최적화에 집중!

### 2. 최적화 효과 측정
```
# 최적화 전
신호 탐색: 12.09초 (78.0%)

# 최적화 후
신호 탐색: 3.50초 (50.0%)
```
→ 71% 개선!

### 3. 코인별 비교
```
BTCUSDT: 15.86초
ETHUSDT: 14.23초
FOLKSUSDT: 18.92초  # 가장 느림
```
→ FOLKSUSDT가 왜 느린지 분석

---

## 🎯 결론

**현재 병목**: 신호 탐색 (78%)
**해결 방법**: 비트코인 추세 캐싱
**예상 효과**: 70-80% 시간 감소

백테스팅을 실행하면 자동으로 시간 분석이 출력됩니다!
